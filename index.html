<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üß® ‰∏ôÂçàÈ©¨Âπ¥ ¬∑ Èô§Â§ïÂÆàÂ≤Å üß®</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéá</text></svg>">
    <script src="https://unpkg.com/hydrogen-js-sdk@2.5.1/dist/Bmob-2.5.1.min.js"></script>
    <style>
        body {
            margin: 0; padding: 0; overflow: hidden;
            background: linear-gradient(135deg, #a80000, #ff0000); 
            color: #ffd700;
            font-family: "Microsoft YaHei", sans-serif;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            height: 100vh;
            user-select: none; -webkit-tap-highlight-color: transparent; 
        }

        #danmaku-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 85%;
            z-index: 20; 
            pointer-events: none; 
            overflow: hidden;
        }

        .danmaku-item {
            position: absolute; white-space: nowrap;
            font-size: 1.4rem; font-weight: 900;
            text-shadow: 2px 2px 0 #000;
            opacity: 0.9;
            animation: moveLeft linear 1 forwards; 
        }
        @keyframes moveLeft {
            from { transform: translateX(100vw); }
            to { transform: translateX(-200%); }
        }

        .input-area {
            position: absolute; bottom: 30px; width: 92%; max-width: 500px;
            display: flex; z-index: 100; 
            background: rgba(255, 255, 255, 0.15); 
            padding: 8px;
            border-radius: 50px; border: 1px solid rgba(255,215,0,0.5);
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }
        #danmaku-input {
            flex: 1; background: transparent; border: none;
            color: #fff; padding: 0 15px; outline: none; font-size: 1.1rem;
        }
        #danmaku-input::placeholder { color: rgba(255,255,255,0.7); }
        #send-btn {
            background: linear-gradient(to bottom, #ffd700, #ffaa00);
            border: none; color: #800000;
            padding: 10px 25px; border-radius: 40px;
            cursor: pointer; font-weight: 900; white-space: nowrap;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        #send-btn:active { transform: scale(0.95); }

        #canvas-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }
        
        .content { 
            z-index: 10; 
            text-align: center; margin-bottom: 80px;
            background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(12px);          
            -webkit-backdrop-filter: blur(12px);  
            padding: 30px; border-radius: 20px;                  
            border: 1px solid rgba(255, 255, 255, 0.2); 
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2); 
        }

        h1 { font-size: 2.8rem; margin: 0 0 10px 0; text-shadow: 0 0 20px #ff0000; letter-spacing: 2px; }
        #timer { font-size: 3.5rem; font-weight: 800; font-family: 'Courier New', monospace; color: #fff; text-shadow: 0 0 15px #ff4500; margin-bottom: 15px; }
        .horse-btn { font-size: 6rem; cursor: pointer; transition: all 0.2s; display: inline-block; filter: drop-shadow(0 0 15px gold); }
        .horse-btn:active { transform: scale(0.8); }
        #blessing { margin-top: 10px; font-size: 1.5rem; min-height: 1.5em; color: #fff; font-weight: bold; opacity: 0; transition: opacity 0.5s; text-shadow: 0 0 5px gold; }
        .shake-hint { font-size: 0.8rem; color: #ffcccc; margin-top: 10px; animation: blink 3s infinite; }
        @keyframes blink { 0%,100% {opacity: 0.6} 50% {opacity: 1} }
    </style>
</head>
<body>

    <div id="danmaku-container"></div>
    <div id="canvas-container"><canvas id="fireworks"></canvas></div>

    <div class="content">
        <h1>üß® ‰∏ôÂçàÈ©¨Âπ¥ ¬∑ Èô§Â§ïÂÆàÂ≤Å üß®</h1>
        <div id="timer">00:00:00</div>
        
        <div class="horse-btn" id="horse" onclick="giveBlessing()">üêé</div>
        
        <div id="blessing"></div>
        <div class="shake-hint">üì± Êëá‰∏ÄÊëá / üíª ÁÇπÂáªÂ±èÂπïÊîæÁÉüËä±</div>
    </div>

    <div class="input-area">
        <input type="text" id="danmaku-input" placeholder="ËæìÂÖ•Á•ùÁ¶è..." maxlength="40">
        <button id="send-btn" onclick="sendBmobDanmaku()">üéá ÂèëÂ∞Ñ</button>
    </div>

    <script>
        const SECRET_KEY = "9ac11c753e9ad59c"; 
        const API_SAFE_CODE = "vgrwe83rtrwiveiw"; 

        let isDbReady = false;
        try {
            if(typeof Bmob !== 'undefined') {
                Bmob.initialize(SECRET_KEY, API_SAFE_CODE);
                isDbReady = true;
                console.log("Bmob ÂàùÂßãÂåñÊàêÂäü");
            }
        } catch (e) {
            console.error("Bmob ÂàùÂßãÂåñÂ§±Ë¥•", e);
        }

        const danmakuContainer = document.getElementById('danmaku-container');
        let processedIds = new Set(); 

        let danmakuPool = [
            "Êñ∞Âπ¥Âø´‰πêÔºÅ", "ÊÅ≠ÂñúÂèëË¥¢", "È©¨Âπ¥Â§ßÂêâ", "Ë∫´‰ΩìÂÅ•Â∫∑", 
            "‰ª£Á†ÅÊó†Bug", "Â∑•ËµÑÁøªÂÄç", "offerÊãøÂà∞ÊâãËΩØ", 
            "‰∏á‰∫ãÂ¶ÇÊÑè", "Èô§Â§ïÂø´‰πê", "Happy New Year", 
            "2026 ÂÜ≤È∏≠", "Âπ≥ÂÆâÂñú‰πê", "Â•ΩËøêËøûËøû", "È©¨Âà∞ÊàêÂäü",
            "Ë¥¢Ê∫êÂπøËøõ", "ÂøÉÊÉ≥‰∫ãÊàê", "Â§ßÂêâÂ§ßÂà©", "Ê≠•Ê≠•È´òÂçá"
        ];

        function shootDanmaku(text, isMine = false) {
            const el = document.createElement('div');
            el.className = 'danmaku-item';
            el.innerText = text;
            
            el.style.top = (Math.random() * 85 + 5) + '%'; 
            el.style.color = isMine ? '#adff2f' : (Math.random() > 0.6 ? '#fff' : '#ffd700'); 
            if(isMine) el.style.zIndex = 999; 
            
            const duration = Math.random() * 5 + 8; 
            el.style.animationDuration = duration + 's';

            danmakuContainer.appendChild(el);
            el.addEventListener('animationend', () => el.remove());
        }

        function autoPlayLoop() {
            const text = danmakuPool[Math.floor(Math.random() * danmakuPool.length)];
            shootDanmaku(text, false);
            const nextDelay = Math.random() * 900 + 600; 
            setTimeout(autoPlayLoop, nextDelay);
        }
        autoPlayLoop();

        function sendBmobDanmaku() {
            const input = document.getElementById('danmaku-input');
            const text = input.value.trim();
            if (!text) return;
            
            shootDanmaku(text, true);
            danmakuPool.push(text);
            input.value = '';

            if (isDbReady) {
                const query = Bmob.Query('danmaku');
                query.set("text", text);
                query.save().catch(err => console.log("‰∫ëÁ´ØÂ≠òÂÇ®Â§±Ë¥•"));
            }
        }

        function fetchBmobDanmaku() {
            if (!isDbReady) return;

            const query = Bmob.Query("danmaku");
            query.order("-createdAt"); 
            query.limit(20);  
            
            query.find().then(res => {
                res.reverse().forEach(item => {
                    const id = item.objectId;
                    if (!processedIds.has(id)) {
                        processedIds.add(id);
                        danmakuPool.push(item.text);
                        setTimeout(() => shootDanmaku(item.text), Math.random() * 1000);
                    }
                });
                if(danmakuPool.length > 100) {
                    danmakuPool = danmakuPool.slice(-100);
                }
            }).catch(err => {});
        }
        setInterval(fetchBmobDanmaku, 3000);

        document.getElementById('danmaku-input').addEventListener('keypress', (e) => {
            if(e.key === 'Enter') sendBmobDanmaku();
        });

        const targetDate = new Date("February 17, 2026 00:00:00").getTime();
        function updateTimer() {
            const now = new Date().getTime();
            const distance = targetDate - now;
            
            if (distance < 0) {
                document.getElementById("timer").innerHTML = "üéâ Êñ∞Âπ¥Âø´‰πêÔºÅüéâ";
                document.querySelector("h1").innerText = "È©¨Âπ¥Â§ßÂêâ ¬∑ ‰∏á‰∫ãÂ¶ÇÊÑè";
                return;
            }
            
            const h = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((distance % (1000 * 60)) / 1000);
            
            const strH = h < 10 ? "0" + h : h;
            const strM = m < 10 ? "0" + m : m;
            const strS = s < 10 ? "0" + s : s;
            
            document.getElementById("timer").innerHTML = `${strH}:${strM}:${strS}`;
        }
        setInterval(updateTimer, 1000); updateTimer();

        const blessings = [
            "‰∏ÄÈ©¨ÂΩìÂÖà", "È©¨Âà∞ÊàêÂäü", "ÈæôÈ©¨Á≤æÁ•û", "‰∏áÈ©¨Â•îËÖæ", 
            "Ê±óÈ©¨ÂäüÂä≥", "Â§©È©¨Ë°åÁ©∫", "ËÄÅÈ©¨ËØÜÈÄî", "ÈáëÈ©¨ËøéÊò•",
            "Ë¥¢Ê∫êÂπøËøõ", "Ë∫´‰ΩìÂÅ•Â∫∑", "Â≠¶‰∏öÊúâÊàê", "‰ª£Á†ÅÊó†Bug",
            "ÂèëË¥¢Êö¥ÂØå", "ËÑ±ÂçïÊàêÂäü", "ËÆ∫ÊñáÂøÖËøá", "Áî≤Êñπ‰∏çÂÇ¨",
            "‰ΩìÈáçÂáèÂçä", "Â∑•ËµÑÁøªÂÄç", "Â•ΩËøêËé≤Ëé≤"
        ];
        function giveBlessing() {
            const horse = document.getElementById("horse");
            const text = document.getElementById("blessing");
            
            horse.style.transform = "scale(1.3) rotate(15deg)";
            setTimeout(() => horse.style.transform = "scale(1) rotate(0)", 150);
            
            text.innerText = "‚ú® " + blessings[Math.floor(Math.random() * blessings.length)] + " ‚ú®";
            text.style.opacity = 1;
            createFirework(window.innerWidth/2, window.innerHeight/2);
        }

        let lastX=0, lastY=0, lastZ=0, lastTime=0, lastShakeTime=0;
        if (window.DeviceMotionEvent) {
            window.addEventListener('devicemotion', function(event) {
                const cur = event.accelerationIncludingGravity; if(!cur) return;
                const now = new Date().getTime();
                if ((now - lastTime) > 100) {
                    const diff = now - lastTime; lastTime = now;
                    const speed = Math.abs(cur.x+cur.y+cur.z - lastX-lastY-lastZ)/diff * 10000;
                    if (speed > 2000 && now - lastShakeTime > 500) {
                        createFirework(window.innerWidth/2, window.innerHeight/2);
                        if(navigator.vibrate) navigator.vibrate(50);
                        lastShakeTime = now;
                    }
                    lastX=cur.x; lastY=cur.y; lastZ=cur.z;
                }
            });
        }

        const canvas = document.getElementById("fireworks"); const ctx = canvas.getContext("2d"); let particles = [];
        function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resizeCanvas); resizeCanvas();
        class Particle {
            constructor(x, y, color) {
                this.x = x; this.y = y; this.color = color;
                const angle = Math.random() * Math.PI * 2; const speed = Math.random() * 6 + 2;
                this.vx = Math.cos(angle) * speed; this.vy = Math.sin(angle) * speed;
                this.alpha = 1; this.friction = 0.96; this.gravity = 0.05;
            }
            draw() { ctx.globalAlpha = this.alpha; ctx.fillStyle = this.color; ctx.beginPath(); ctx.arc(this.x, this.y, 3, 0, Math.PI * 2); ctx.fill(); }
            update() { this.vx *= this.friction; this.vy *= this.friction; this.vy += this.gravity; this.x += this.vx; this.y += this.vy; this.alpha -= 0.015; }
        }
        function createFirework(x, y) {
            const colors = ['#ff0040', '#ffff00', '#00ff00', '#00ccff', '#ff9900'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            for (let i = 0; i < 30; i++) particles.push(new Particle(x, y, color));
        }
        function animate() {
            requestAnimationFrame(animate);
            ctx.globalCompositeOperation = 'destination-out'; ctx.fillStyle = 'rgba(0, 0, 0, 0.2)'; ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.globalCompositeOperation = 'lighter';
            particles = particles.filter(p => p.alpha > 0);
            particles.forEach(p => { p.update(); p.draw(); });
        }
        document.addEventListener('click', (e) => { 
            if(e.target.id !== 'horse' && e.target.id !== 'danmaku-input' && e.target.id !== 'send-btn') 
                createFirework(e.clientX, e.clientY); 
        });
        animate();
    </script>
</body>

</html>
